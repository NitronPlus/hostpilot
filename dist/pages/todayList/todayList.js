"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),_get=function t(e,i,o){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(void 0===a){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,o)}if("value"in a)return a.value;var n=a.get;return void 0!==n?n.call(o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_request=require("../../common/request.js"),_request2=_interopRequireDefault(_request);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var scanImage="/assets/imgs/add.png",TodayList=(_temp2=_class=function(t){function n(){var t,e,i;_classCallCheck(this,n);for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=i=_possibleConstructorReturn(this,(t=n.__proto__||Object.getPrototypeOf(n)).call.apply(t,[this].concat(a)))).$usedState=["anonymousState__temp","anonymousState__temp4","loopArray0","loopArray1","scanImage","duringList","hasList","total_amount","total_delivery_qty"],i.config={navigationBarTitleText:"到店确认",enablePullDownRefresh:!0},i.$$refs=[],_possibleConstructorReturn(i,e)}return _inherits(n,_index.Component),_createClass(n,[{key:"_constructor",value:function(t){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_constructor",this).call(this,t),this.state={duringList:[],hasList:[],total_amount:0,total_delivery_qty:0},this.data={isLoad:!0}}},{key:"componentDidShow",value:function(){0!=this.data.isLoad?this.requestDeliveryList():this.data.isLoad=!0}},{key:"onPullDownRefresh",value:function(){this.requestDeliveryList()}},{key:"requestDeliveryList",value:function(){var o=this,t={driver_id:_index2.default.getApp().globalData.driver_id};_request2.default.post("DriverMiniProgram/get-delivery-arrival-list",t).then(function(t){_index2.default.stopPullDownRefresh();var e=[],i=[];0==t.data.arrival_list.length&&_index2.default.showModal({title:"提示",content:"您尚未添加配送单",showCancel:!1,confirmText:"去添加",success:function(t){t.confirm&&_index2.default.redirectTo({url:"/pages/deliveryList/deliveryList?isNeedScan=true"})}}),t.data.arrival_list.map(function(t){"START_DELIVERY"==t.status||"CONFIRMED_PRODUCTS"==t.status?e.push(t):"CONFIRMED_VIDEO_AND_POSITION"==t.status&&i.push(t)}),o.setState({duringList:e,hasList:i,total_amount:t.data.total_amount,total_delivery_qty:t.data.total_delivery_qty})}).catch(function(t){console.log(t)})}},{key:"addNewDelivery",value:function(){var o=this;_index2.default.scanCode({onlyFromCamera:!0,success:function(t){var e={order_ids:t.result};_request2.default.post("DriverMiniProgram/get-delivery-order",e).then(function(t){var i=t.data;_index2.default.showModal({title:"提示",content:"确认要加入新的配送单吗",success:function(t){if(t.confirm){var e={driver_id:_index2.default.getApp().globalData.driver_id,gid_arr:JSON.stringify([i.gid])};_request2.default.post("DriverMiniProgram/add-delivery-arrival",e).then(function(t){o.requestDeliveryList()}).catch(function(t){console.log(t)})}}})}).catch(function(t){console.log(t),o.data.isLoad=!1})}})}},{key:"statusClick",value:function(t,e,i){"START_DELIVERY"==t?_index2.default.navigateTo({url:"../commodityConfirm/commodityConfirm?isEditable=true&id="+e}):"CONFIRMED_PRODUCTS"==t&&_index2.default.navigateTo({url:"../setLocation/setLocation?id="+e+"&store_name="+i})}},{key:"cellClick",value:function(t,e,i){"START_DELIVERY"==t?_index2.default.navigateTo({url:"../commodityConfirm/commodityConfirm?isEditable=true&id="+e}):"CONFIRMED_PRODUCTS"==t?_index2.default.navigateTo({url:"../setLocation/setLocation?id="+e+"&store_name="+i}):"CONFIRMED_VIDEO_AND_POSITION"==t&&(console.log("CONFIRMED_VIDEO_AND_POSITION"),_index2.default.navigateTo({url:"../commodityConfirm/commodityConfirm?isEditable=false&id="+e}))}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var t="送货中("+this.__state.duringList.length+")",e="已送达("+this.__state.hasList.length+")",i=this.__state.duringList.map(function(t){return{$loopState__temp3:(t={$original:(0,_index.internal_get_original)(t)}).$original.total_delivery_qty+"kg",$original:t.$original}}),o=this.__state.hasList.map(function(t){return{$loopState__temp6:(t={$original:(0,_index.internal_get_original)(t)}).$original.total_delivery_qty+"kg",$original:t.$original}});return Object.assign(this.__state,{anonymousState__temp:t,anonymousState__temp4:e,loopArray0:i,loopArray1:o,scanImage:scanImage}),this.__state}}]),n}(),_class.properties={},_class.$$events=["addNewDelivery","cellClick","statusClick"],_temp2);exports.default=TodayList,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TodayList,!0));