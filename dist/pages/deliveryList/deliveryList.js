"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),_get=function e(t,r,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,o)}if("value"in a)return a.value;var i=a.get;return void 0!==i?i.call(o):void 0},_index=require("../../npm/@tarojs/redux/index.js"),_index2=require("../../npm/@tarojs/taro-weapp/index.js"),_index3=_interopRequireDefault(_index2),_request=require("../../common/request.js"),_request2=_interopRequireDefault(_request),_driverData=require("../../actions/driverData.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var addNewImage="/assets/imgs/add.png",DeliveryList=(_dec=(0,_index.connect)(function(e){return{driverData:e.driverData}},function(t){return{coverGood:function(e){t((0,_driverData.coverGood)(e))},addGood:function(e){t((0,_driverData.addGood)(e))}}}))((_temp2=_class2=function(e){function i(){var e,t,r;_classCallCheck(this,i);for(var o=arguments.length,a=Array(o),n=0;n<o;n++)a[n]=arguments[n];return(t=r=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(a)))).$usedState=["anonymousState__temp3","loopArray0","addNewImage","dataList","showInputModal","order_ids","driverData","coverGood","addGood"],r.state={dataList:[],showInputModal:!1,order_ids:void 0},r.data={isUpdate:!1},r.config={navigationBarTitleText:"出库确认"},r.$$refs=[],_possibleConstructorReturn(r,t)}return _inherits(i,_index2.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e)}},{key:"componentDidMount",value:function(){var e=this.props.driverData.scanList;"true"==this.$router.params.isNeedScan&&0==e.length?this.addOrder():this.setState({dataList:e})}},{key:"componentDidShow",value:function(){this.data.isUpdate&&this.setState({dataList:this.props.driverData.scanList}),this.data.isUpdate=!0}},{key:"confirmTodayDeliveryList",value:function(){var t=this,e=this.props.driverData.scanList,r=[];e.forEach(function(e){r.push(e.gid)});var o={driver_id:_index3.default.getApp().globalData.driver_id,gid_arr:JSON.stringify(r)};_request2.default.post("DriverMiniProgram/check-add-delivery-arrival",o).then(function(e){t.props.coverGood([]),""!=e.data?_index3.default.showModal({title:"确认成功",content:e.data,showCancel:!1,success:function(e){e.confirm&&_index3.default.redirectTo({url:"../readyDeliveryToast/readyDeliveryToast"})}}):_index3.default.redirectTo({url:"../readyDeliveryToast/readyDeliveryToast"})}).catch(function(e){console.log(e)})}},{key:"addOrder",value:function(){var t=this;_index3.default.showModal({title:"提示",content:"扫码或者输入添加配送单",showCancel:!0,confirmText:"去扫码",cancelText:"去输入",success:function(e){e.confirm?t.addMoreClick():t.setState({showInputModal:!0})}})}},{key:"finishAddClick",value:function(){var t=this;0!=this.props.driverData.scanList.length?_index3.default.showModal({title:"提示",content:"请确认是否已添加今日所有配送单?",success:function(e){e.confirm?t.confirmTodayDeliveryList():e.cancel&&console.log("用户点击取消")}}):_index3.default.showToast({title:"当前配送单为空",icon:"none",duration:2e3})}},{key:"addMoreClick",value:function(){var t=this,r=this.props.driverData.scanList;_index3.default.scanCode({onlyFromCamera:!0,success:function(e){t.setState({order_ids:e.result},function(){t.requestOrder()})},fail:function(e){t.setState({dataList:r})}})}},{key:"requestOrder",value:function(){var o=this,e={order_ids:this.state.order_ids};_request2.default.post("DriverMiniProgram/get-delivery-order",e).then(function(e){o.setState({order_ids:void 0}),o.hideInputModal();var t=e.data;t.isConfirm=!1;var r=o.props.driverData.scanList;r.some(function(e){return e.gid==t.gid})?_index3.default.showToast({title:"该订单重复添加...",icon:"none"}):(o.props.addGood(t),o.setState({dataList:r}))}).catch(function(e){console.log(e)})}},{key:"hideInputModal",value:function(){this.setState({showInputModal:!1})}},{key:"detailItem",value:function(e,t){_index3.default.navigateTo({url:"../commodity/commodity?gid="+e+"&storeGid="+t})}},{key:"deleteItem",value:function(r){var o=this.props.driverData.scanList,a=this;o.forEach(function(e,t){e.gid!=r||_index3.default.showModal({title:"提示",content:"确认删除该配送单?",success:function(e){e.confirm?(o.splice(t,1),a.setState({dataList:o})):e.cancel&&console.log("用户点击取消")}})})}},{key:"_createData",value:function(){var t=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];this.anonymousFunc0=function(e){return t.setState({order_ids:e.detail.value})};var e=this.__state.dataList.map(function(e){return{$loopState__temp2:(e={$original:(0,_index2.internal_get_original)(e)}).$original.total_delivery_qty+"kg",$original:e.$original}});return Object.assign(this.__state,{anonymousState__temp3:{background:"orange"},loopArray0:e,addNewImage:addNewImage}),this.__state}},{key:"anonymousFunc0",value:function(e){}}]),i}(),_class2.properties={driverData:{type:null,value:null},coverGood:{type:null,value:null},addGood:{type:null,value:null}},_class2.$$events=["detailItem","deleteItem","addOrder","finishAddClick","anonymousFunc0","hideInputModal","requestOrder"],_class=_temp2))||_class;exports.default=DeliveryList,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(DeliveryList,!0));