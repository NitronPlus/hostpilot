"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function a(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),_get=function t(e,o,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,o);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,o,a)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(a):void 0},_index=require("../../npm/@tarojs/redux/index.js"),_index2=require("../../npm/@tarojs/taro-weapp/index.js"),_index3=_interopRequireDefault(_index2),_request=require("../../common/request.js"),_request2=_interopRequireDefault(_request),_driverData=require("../../actions/driverData.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var radioImage="/assets/imgs/radio_btn_selected.png",radioNormarlImage="/assets/imgs/radio_btn_normal.png",Commodity=(_dec=(0,_index.connect)(function(t){return{driverData:t.driverData}},function(a){return{coverGood:function(t){a((0,_driverData.coverGood)(t))},assignGood:function(t,e,o){a((0,_driverData.assignGood)(t,e,o))}}}))((_temp2=_class2=function(t){function s(){var t,e,o;_classCallCheck(this,s);for(var a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=o=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(r)))).$usedState=["showData","radioImage","radioNormarlImage","currentTabIndex","tabList","commodityData","showDataList","isChooseAll","globalDataListCopy","globalDataPosition","driverData","coverGood","assignGood"],o.config={navigationBarTitleText:"出库验货"},o.state={currentTabIndex:0,tabList:[{id:0,name:"全部"},{id:1,name:"水果"},{id:2,name:"物料"}],commodityData:{},showDataList:[],isChooseAll:!1,globalDataListCopy:[],globalDataPosition:0},o.$$refs=[],_possibleConstructorReturn(o,e)}return _inherits(s,_index2.Component),_createClass(s,[{key:"_constructor",value:function(t){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,t)}},{key:"componentWillMount",value:function(){var t=this.$router.params.gid,e=this.$router.params.storeGid;this.getDataFromServer(t,e)}},{key:"getDataFromServer",value:function(s,t){var n=this,e={gid:s,FK_store_gid:t};_request2.default.post("DriverMiniProgram/get-delivery-order-line",e).then(function(t){var e=JSON.stringify(n.props.driverData.scanList),o=JSON.parse(e),a=t.data,r=1;a.products_list.map(function(t){t.isSelected=!1,t.isShow=!0,t.showOrder=r++});var i=0;o.forEach(function(t,e){if(t.gid===s){if(t.deliveryData){var o=a.products_list.map(function(e){return t.deliveryData.products_list.forEach(function(t){t.id===e.id&&(e.isSelected=t.isSelected)}),e});a.products_list=o,t.deliveryData=a}else t.deliveryData=a;i=e}}),n.setState({globalDataListCopy:o,commodityData:o[i].deliveryData,showDataList:o[i].deliveryData.products_list,globalDataPosition:i})})}},{key:"onBtnConfirmClicked",value:function(){this.props.coverGood(this.state.globalDataListCopy),this.props.assignGood(this.state.globalDataPosition,"isConfirm",!0),_index3.default.navigateBack({delta:1})}},{key:"onTabClick",value:function(t){if(0===t){var e=1,o=this.state.showDataList.map(function(t){return t.isShow=!0,t.showOrder=e++,t});this.setState({showDataList:o,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}else if(2===t){var a=1,r=this.state.showDataList.map(function(t){return"MATERIAL"===t.product_category?(t.isShow=!0,t.showOrder=a++):(t.isShow=!1,t.showOrder=0),t});this.setState({showDataList:r,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}else{var i=1,s=this.state.showDataList.map(function(t){return"FRUITS"===t.product_category?(t.isShow=!0,t.showOrder=i++):(t.isShow=!1,t.showOrder=0),t});this.setState({showDataList:s,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}}},{key:"onRadioBtnClicked",value:function(o){var t=this.state.showDataList.map(function(t,e){return e===o&&(t.isSelected=!t.isSelected),t});this.setState({showDataList:t},this.checkAndChangeChooseAllStatus(this.state.currentTabIndex))}},{key:"checkAndChangeChooseAllStatus",value:function(t){var e=!0;e=0===t?this.state.showDataList.every(function(t){return t.isSelected}):2===t?this.state.showDataList.filter(function(t){return"MATERIAL"===t.product_category}).every(function(t){return t.isSelected}):this.state.showDataList.filter(function(t){return"FRUITS"===t.product_category}).every(function(t){return t.isSelected}),this.setState({isChooseAll:e})}},{key:"onAllChooseBtnClicked",value:function(o){var a=this,t=this.state.showDataList.map(function(t,e){return 0===a.state.currentTabIndex?t.isSelected=o:1===a.state.currentTabIndex?"FRUITS"===t.product_category&&(t.isSelected=o):"MATERIAL"===t.product_category&&(t.isSelected=o),t});this.setState({showDataList:t,isChooseAll:o})}},{key:"onEditBtnClicked",value:function(t){}},{key:"onCommodityPieceInput",value:function(t){}},{key:"onCommodityNumberInput",value:function(t){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var t=this.__state.showDataList;return this.__state.commodityData?(Object.assign(this.__state,{showData:t,radioImage:radioImage,radioNormarlImage:radioNormarlImage}),this.__state):null}}]),s}(),_class2.properties={driverData:{type:null,value:null},coverGood:{type:null,value:null},assignGood:{type:null,value:null}},_class2.$$events=["onTabClick","onAllChooseBtnClicked","onRadioBtnClicked","onBtnConfirmClicked"],_class=_temp2))||_class;exports.default=Commodity,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Commodity,!0));