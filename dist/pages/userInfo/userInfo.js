"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,a)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(a):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_request=require("../../common/request.js"),_request2=_interopRequireDefault(_request),_api=require("../../common/api.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var UserInfo=(_temp2=_class=function(e){function i(){var e,t,a;_classCallCheck(this,i);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=a=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(o)))).$usedState=["anonymousState__temp","anonymousState__temp2","loopArray0","isSelCompany","carType","seletedIndex","phone","carCompany","companySel","staffName"],a.state={carType:[],seletedIndex:0,phone:_index2.default.getApp().globalData.mobile,carCompany:"",companySel:[],staffName:""},a.data={companyList:[],companyAllList:[]},a.onCompanyChange=function(e){var t=e.detail.value;if(t.length<2)a.setState({companySel:[]});else{var n=a.data.companyList.filter(function(e){return-1<e.indexOf(t)});0<n.length&&a.setState({companySel:n,carCompany:t})}},a.modifyPhoneNumber=function(){_index2.default.navigateTo({url:"../modifyPhoneNumber/modifyPhoneNumber"})},a.onCompanyItemClick=function(e){a.setState({carCompany:e,companySel:[]},function(){a.getCarTypeList()})},a.anonymousFunc1Array=[],a.$$refs=[],_possibleConstructorReturn(a,t)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e)}},{key:"componentWillMount",value:function(){var n=this;_request2.default.get(_api.API_GET_DELIVERY_COMPANY).then(function(e){var t=e.data.map(function(e){return e.company_name});n.data.companyList=t,n.data.companyAllList=e.data})}},{key:"componentDidMount",value:function(){_index2.default.setNavigationBarTitle({title:"注册信息"})}},{key:"componentDidShow",value:function(){this.state.phone!=_index2.default.getApp().globalData.mobile&&this.setState({phone:_index2.default.getApp().globalData.mobile})}},{key:"onChange",value:function(e){console.log(this.state.carType),console.log(e),this.setState({seletedIndex:e.detail.value})}},{key:"submit",value:function(){if(""!==this.state.staffName){var e=this.carName2Id(this.state.carCompany);if(-1!=e){var t={driver_id:_index2.default.getApp().globalData.driver_id,driver_mobile:_index2.default.getApp().globalData.mobile,driver_name:this.state.staffName,driver_car_type:this.state.carType[this.state.seletedIndex],FK_delivery_company_id:e};_request2.default.post("DriverMiniProgram/register",t).then(function(e){_index2.default.getApp().globalData.userHasLogin=!0,_index2.default.reLaunch({url:"/pages/home/home?isRedirect=true"})}).catch(function(e){console.log(e)})}else _index2.default.showToast({title:"您填写的配送公司不存在...",icon:"none",duration:2e3})}else _index2.default.showToast({title:"请填写姓名...",icon:"none",duration:2e3})}},{key:"inputChange",value:function(e){this.setState({staffName:e.detail.value})}},{key:"getCarTypeList",value:function(){var t=this,e=this.data.companyAllList.find(function(e){return e.company_name=t.state.carCompany});_request2.default.post("DriverMiniProgram/get-car-type-list",{FK_delivery_company_id:e.id}).then(function(e){t.setState({carType:e.data})}).catch(function(e){console.log(e)})}},{key:"carName2Id",value:function(t){var n=-1;return this.data.companyAllList.some(function(e){if(e.company_name===t)return n=e.id,!0}),n}},{key:"_createData",value:function(){var n=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=0<this.__state.companySel.length,t=console.log("view"+this.__state.carCompany);this.anonymousFunc0=function(e){return n.onCompanyChange(e)};var a=this.__state.carType[this.__state.seletedIndex],o=e?this.__state.companySel.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},n.anonymousFunc1Array[t]=function(){return n.onCompanyItemClick(e.$original)},{$original:e.$original}}):[];return Object.assign(this.__state,{anonymousState__temp:t,anonymousState__temp2:a,loopArray0:o,isSelCompany:e}),this.__state}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e,t){this.anonymousFunc1Array[e]&&this.anonymousFunc1Array[e](t)}}]),i}(),_class.properties={},_class.$$events=["inputChange","anonymousFunc0","anonymousFunc1","modifyPhoneNumber","onChange","submit"],_temp2);exports.default=UserInfo,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(UserInfo,!0));