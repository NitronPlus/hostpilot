"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommodityConfirm=void 0;var _class,_temp2,_createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}(),_get=function t(e,a,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,a);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,a,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../npm/classnames/index.js"),_index4=_interopRequireDefault(_index3),_request=require("../../common/request.js"),_request2=_interopRequireDefault(_request);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var radioImage="/assets/imgs/radio_btn_normal.png",radioSelectedImage="/assets/imgs/radio_btn_selected.png",CommodityConfirm=exports.CommodityConfirm=(_temp2=_class=function(t){function r(){var t,e,o;_classCallCheck(this,r);for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=o=_possibleConstructorReturn(this,(t=r.__proto__||Object.getPrototypeOf(r)).call.apply(t,[this].concat(n)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp8","anonymousState__temp9","anonymousState__temp10","anonymousState__temp11","anonymousState__temp12","loopArray0","showData","showList","radioSelectedImage","radioImage","id","currentTabIndex","currentItemIndex","tabList","canEdit","isDialogShow","currentListItem","arrivalCount","arrivalNumber","commodityData","showDataList","isChooseAll","videoUrl"],o.config={navigationBarTitleText:"商品确认"},o.state={id:0,currentTabIndex:0,currentItemIndex:0,tabList:[{id:0,name:"全部"},{id:1,name:"水果"},{id:2,name:"物料"}],canEdit:"false",isDialogShow:!1,currentListItem:{},arrivalCount:0,arrivalNumber:0,commodityData:{},showDataList:[],isChooseAll:!1,videoUrl:""},o.onBtnConfirmClicked=function(){!o.state.showDataList||o.state.showDataList.length<=0?_index2.default.showToast({title:"没有需要确认的商品",icon:"none",duration:2e3}):_index2.default.showModal({title:"提示",content:"是否确认提交",confirmText:"是",cancelText:"否",success:function(t){!0===t.confirm?o.submitData():console.log("canceled")}})},o.onRadioBtnClicked=function(n){var t=o.state.showDataList.map(function(t,e){if(e===n){var a=t.status;t.status="HAS_CONFIRM"===a?"NOT_CONFIRM":"HAS_CONFIRM"}return t});o.setState({showDataList:t},o.checkAndChangeChooseAllStatus(o.state.currentTabIndex))},o.checkAndChangeChooseAllStatus=function(t){var e=!0;e=0===t?o.state.showDataList.every(function(t){return"HAS_CONFIRM"===t.status}):2===t?o.state.showDataList.filter(function(t){return"MATERIAL"===t.product_category}).every(function(t){return"HAS_CONFIRM"===t.status}):o.state.showDataList.filter(function(t){return"FRUITS"===t.product_category}).every(function(t){return"HAS_CONFIRM"===t.status}),o.setState({isChooseAll:e})},o.onAllChooseBtnClicked=function(t){var a="NOT_CONFIRM";t&&(a="HAS_CONFIRM");var e=o.state.showDataList.map(function(t,e){return 0===o.state.currentTabIndex?t.status=a:1===o.state.currentTabIndex?"FRUITS"===t.product_category&&(t.status=a):"MATERIAL"===t.product_category&&(t.status=a),t});o.setState({showDataList:e,isChooseAll:t})},o.onArrivalCountInput=function(t){var e=t.detail.value,a=e*o.state.currentListItem.ratio;a=a.toFixed(2),o.setState({arrivalCount:e,arrivalNumber:a})},o.onArrivalNumberInput=function(t){o.setState({arrivalNumber:t.detail.value})},o.confirmDialog=function(){""!==o.state.arrivalCount&&o.state.arrivalCount?""!==o.state.arrivalNumber&&o.state.arrivalNumber?o.setState({isDialogShow:!1},o.updateCommodityInfo()):_index2.default.showToast({title:"请输入到货数量",icon:"none",duration:2e3}):_index2.default.showToast({title:"请输入到货份数",icon:"none",duration:2e3})},o.cancelDialog=function(){o.setState({isDialogShow:!1})},o.$$refs=[],_possibleConstructorReturn(o,e)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,t)}},{key:"componentWillMount",value:function(){var t=this.$router.params.id,e=this.$router.params.isEditable;this.setState({canEdit:e,id:t}),this.getDataFromServer(t)}},{key:"getDataFromServer",value:function(t){var n=this,e={id:t};_request2.default.post("DriverMiniProgram/get-delivery-arrival-line",e).then(function(t){if(!0===t.result){var e=Object.assign({},t.data),a=1;e.products_list.map(function(t){t.isShow=!0,t.showOrder=a++}),n.state.showDataList=e.products_list,n.setState({videoUrl:e.arrival_video_url,commodityData:e,canEdit:n.$router.params.isEditable},n.onTabClick(n.state.currentTabIndex))}else _index2.default.showToast(t.msg)}).catch(function(t){_index2.default.showToast({title:t.msg,icon:"none",duration:2e3})})}},{key:"onTabClick",value:function(t){if(0===t){var e=1,a=this.state.showDataList.map(function(t){return t.isShow=!0,t.showOrder=e++,t});this.setState({showDataList:a,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}else if(2===t){var n=1,o=this.state.showDataList.map(function(t){return"MATERIAL"===t.product_category?(t.isShow=!0,t.showOrder=n++):(t.isShow=!1,t.showOrder=0),t});this.setState({showDataList:o,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}else{var i=1,r=this.state.showDataList.map(function(t){return"FRUITS"===t.product_category?(t.isShow=!0,t.showOrder=i++):(t.isShow=!1,t.showOrder=0),t});this.setState({showDataList:r,currentTabIndex:t},this.checkAndChangeChooseAllStatus(t))}}},{key:"updateCommodityInfo",value:function(){var a=this,t={id:this.state.currentListItem.id,arrival_count:this.state.arrivalCount,arrival_num:this.state.arrivalNumber};_request2.default.post("DriverMiniProgram/confirm-delivery-arrival-line",t).then(function(t){var e="";!0===t.result?(e="更新商品信息成功",a.getDataFromServer(a.state.id)):e=t.msg,_index2.default.showToast({title:e,icon:"none",durarion:1500})})}},{key:"submitData",value:function(){var e=this,a=[];this.state.showDataList.forEach(function(t){var e={};e.id=t.id,e.arrival_num=t.arrival_num,e.arrival_count=t.arrival_count,e.status=t.status,a.push(e)});var t={id:this.state.commodityData.id,products_list:JSON.stringify(a)};_request2.default.post("DriverMiniProgram/confirm-delivery-arrival",t).then(function(t){!0===t.result&&_index2.default.redirectTo({url:"../commodity/uploadInfo/index?id="+e.$router.params.id+"&store_name="+e.state.commodityData.store_name+"&storeId="+e.state.commodityData.FK_store_id})})}},{key:"previewVideoClick",value:function(){0!=this.state.videoUrl.length?_index2.default.navigateTo({url:"../previewVideo/previewVideo?videoUrl="+this.state.videoUrl}):_index2.default.showToast({title:"视频获取失败...",icon:"none"})}},{key:"_createData",value:function(){var a=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var t=this.__state.commodityData,e=this.__state.showDataList;if(!this.__state.commodityData)return null;var n=(0,_index4.default)("top-container","true"!==this.__state.canEdit&&"top-container-less"),o=(0,_index4.default)("title-container-right","true"!==this.__state.canEdit&&"title-container-right-none"),i=(0,_index4.default)("middle-container","true"!==this.__state.canEdit&&"middle-container-less");this.anonymousFunc0=function(t){return a.onArrivalCountInput(t)};var r="KG"===this.__state.currentListItem.sale_uom_name||"KG"===this.__state.currentListItem.sale_uom_name?this.__state.arrivalCount.toString().length:null;this.anonymousFunc1=function(t){return a.onArrivalCountInput(t)};var s="KG"!=this.__state.currentListItem.sale_uom_name&&"kg"!=this.__state.currentListItem.sale_uom_name?this.__state.arrivalCount.toString().length:null;this.anonymousFunc2=function(t){return a.onArrivalNumberInput(t)};var u="KG"===this.__state.currentListItem.uom_name||"kg"===this.__state.currentListItem.uom_name?this.__state.arrivalNumber.toString().length:null;this.anonymousFunc3=function(t){return a.onArrivalNumberInput(t)};var l="KG"!=this.__state.currentListItem.uom_name&&"kg"!=this.__state.currentListItem.uom_name?this.__state.arrivalNumber.toString().length:null,c=this.__state.isDialogShow?(0,_index.internal_inline_style)({backgroundColor:"dodgerblue",color:"white"}):null,_=e.map(function(t,e){return{$loopState__temp5:!0===(t={$original:(0,_index.internal_get_original)(t)}).$original.isShow||"true"===t.$original.isShow?(0,_index4.default)("arrive-text",(t.$original.arrival_count!=t.$original.delivery_count||t.$original.arrival_num!=t.$original.delivery_num)&&"list-content-text-prompt"):null,$loopState__temp7:!0===t.$original.isShow||"true"===t.$original.isShow?(0,_index4.default)("operation-container","true"!==a.__state.canEdit&&"operation-container-none"):null,$original:t.$original}});return Object.assign(this.__state,{anonymousState__temp:n,anonymousState__temp2:o,anonymousState__temp3:i,anonymousState__temp8:r,anonymousState__temp9:s,anonymousState__temp10:u,anonymousState__temp11:l,anonymousState__temp12:c,loopArray0:_,showData:t,showList:e,radioSelectedImage:radioSelectedImage,radioImage:radioImage}),this.__state}},{key:"anonymousFunc0",value:function(t){}},{key:"anonymousFunc1",value:function(t){}},{key:"anonymousFunc2",value:function(t){}},{key:"anonymousFunc3",value:function(t){}}]),r}(),_class.properties={},_class.$$events=["onTabClick","onAllChooseBtnClicked","onRadioBtnClicked","onBtnConfirmClicked","anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3","cancelDialog","confirmDialog"],_temp2);exports.default=CommodityConfirm,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(CommodityConfirm,!0));